'use strict';

const gulp = require('gulp'),
      gulpInsert = require('gulp-insert'),
      gulpSass = require('gulp-sass'),
      gulpSourcemaps = require('gulp-sourcemaps');

const spawn = require('child_process').spawn;

const warningBanner = `/*******************************************************************************
* CAUTION!  DO NOT EDIT THIS FILE!                                             *
*                                                                              *
* This file was generated automatically, and any changes made to it will be    *
* overwritten.  Please do not edit it directly.                                *
*******************************************************************************/

`;

gulp.task('stylesheets', function () {
  const sassOptions = {
    includePaths: []
      .concat(require('bourbon').includePaths)
      .concat(require('bourbon-neat').includePaths),
  };

  return gulp.src('./assets/stylesheets/**/*.{sass,scss}')
    .pipe(gulpSourcemaps.init())
    .pipe(gulpSass(sassOptions).on('error', gulpSass.logError))
    .pipe(gulpInsert.prepend(warningBanner))
    .pipe(gulpSourcemaps.write('./'))
    .pipe(gulp.dest('./assets'))
});

gulp.task('build', gulp.parallel('stylesheets'));

gulp.task('serve', function () {
  spawn('node', ['../../../index.js'], {stdio: 'inherit'});
});
